<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Demonstration for DEFRA – EODH Training Materials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">EODH Training Materials</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/orgs/EO-DataHub/repositories">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/EO-DataHub/eodh-training/discussions">
            Community discussion
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../presentations/DEFRA/1_202409_Defra_DataDiscovery.html">Presentations</a></li><li class="breadcrumb-item"><a href="../../presentations/DEFRA/3_202409_Defra_DataAnalysis.html">DEFRA Data Analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../website/about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">API Client (pyeodh)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../api-client/2_ResourceCatalog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Searching the Resource Catalogue</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Workflows</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../workflows/1_workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflow Introduction</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Presentations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../presentations/DEFRA/1_202409_Defra_DataDiscovery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DEFRA Data Discovery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../presentations/DEFRA/2_202409_Defra_DataProcessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DEFRA Data Processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../presentations/DEFRA/3_202409_Defra_DataAnalysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">DEFRA Data Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-the-eodh" id="toc-what-is-the-eodh" class="nav-link active" data-scroll-target="#what-is-the-eodh">What is the EODH?</a>
  <ul class="collapse">
  <li><a href="#presentation-set-up" id="toc-presentation-set-up" class="nav-link" data-scroll-target="#presentation-set-up">Presentation set up</a></li>
  </ul></li>
  <li><a href="#eodh-its-data-discovery" id="toc-eodh-its-data-discovery" class="nav-link" data-scroll-target="#eodh-its-data-discovery">EODH: it’s data discovery</a></li>
  <li><a href="#todo" id="toc-todo" class="nav-link" data-scroll-target="#todo">TODO!!!!</a></li>
  <li><a href="#display-an-image" id="toc-display-an-image" class="nav-link" data-scroll-target="#display-an-image">DISPLAY AN IMAGE</a></li>
  <li><a href="#eodh-its-massive-compute" id="toc-eodh-its-massive-compute" class="nav-link" data-scroll-target="#eodh-its-massive-compute">EODH: it’s massive compute</a></li>
  <li><a href="#eodh-its-data-analysis" id="toc-eodh-its-data-analysis" class="nav-link" data-scroll-target="#eodh-its-data-analysis">EODH: it’s data analysis</a>
  <ul class="collapse">
  <li><a href="#towards-a-data-cube" id="toc-towards-a-data-cube" class="nav-link" data-scroll-target="#towards-a-data-cube">Towards a data cube?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../presentations/DEFRA/1_202409_Defra_DataDiscovery.html">Presentations</a></li><li class="breadcrumb-item"><a href="../../presentations/DEFRA/3_202409_Defra_DataAnalysis.html">DEFRA Data Analysis</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Demonstration for DEFRA</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Description &amp; purpose</strong>: This Notebook is designed to showcase the initial functionality of the Earth Observation Data Hub. It provides a snapshot of the Hub, the <code>pyeodh</code> API client and the various datasets as of September 2024. The Notebook “user” would like to understand more about the satellite data available for their test areas. This user is also interested in obtaining a cloud free dataset and ultimately creating a data cube. The Notebook is designed in such a way that it can be run on the EODH AppHub (Notebook Service) or from a local environment.</p>
<p><strong>Author(s)</strong>: Alastair Graham, Dusan Figala, Phil Kershaw</p>
<p><strong>Date created</strong>: 2024-09-05</p>
<p><strong>Date last modified</strong>: 2024-09-18</p>
<p><strong>Licence</strong>: This notebook is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>. The code is released using the <a href="https://www.tldrlegal.com/license/bsd-2-clause-license-freebsd">BSD-2-Clause</a> license.</p>
<p><span style="font-size:0.75em;"> Copyright (c) , All rights reserved.</span></p>
<p><span style="font-size:0.75em;"> Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span></p>
<p><span style="font-size:0.75em;"> Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></p>
<p><strong>Links</strong>: * Oxidian: https://www.oxidian.com/ * CEDA: https://www.ceda.ac.uk/ * EO Data Hub: https://eodatahub.org.uk/</p>
<section id="what-is-the-eodh" class="level1">
<h1>What is the EODH?</h1>
<p>The Earth Observation Data Hub is:</p>
<p>“A UK Pathfinder project delivering access to Earth Observation (EO) data for effective decisionmaking across government, business and academia. The Earth Observation DataHub (EODH) brings together an expert project delivery team and industrial partners in an ambitious project… Users of the Hub will be able to explore areas of interest in the UK and across the globe… It will also enable selected users to support their own analyses, services and tools using the Hub’s workflow and compute environments.”</p>
<p>More details can be found online at https://eodatahub.org.uk/</p>
<p>Components of the Hub include: * A Resource Catalogue - a STAC compliant catalogue of open and commercial satellite imagery, climate data, model results, workflows and more * A Workflow Runner - a dedicated piece of cloud infrastructure to horizontally scale workflow requirements * A Web Presence - an intuitive user interface to allow account management, data discovery and mapping * An App Hub - a science portal providing access to a Jupyter lab environment</p>
<section id="presentation-set-up" class="level3">
<h3 class="anchored" data-anchor-id="presentation-set-up">Presentation set up</h3>
<p>The following cell only needs to be run on the EODH AppHub. If you have a local Python environment running, please install the required packages as you would normally.</p>
<div id="a304de62" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If needed you can install a package in the current AppHub Jupyter environment using pip</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For instance, we will need the following libraries</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>{sys.executable} <span class="op">-</span>m pip install <span class="op">--</span>upgrade pyeodh pandas matplotlib numpy pillow folium</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="eodh-its-data-discovery" class="level1">
<h1>EODH: it’s data discovery</h1>
<p>There are a number of API endpoints that are exposed by the EODH. Oxidian have developed a Python API Client, <code>pyeodh</code>, that makes the Hub’s API endpoints available to Python users. <code>pyeodh</code> is available on PyPi (https://pypi.org/project/pyeodh/) and can be installed using <code>pip</code>. Documentation for the API Client is available at: https://pyeodh.readthedocs.io/en/latest/api.html</p>
<p>We will use <code>pyeodh</code> throughout this presentation.</p>
<div id="0a9a1f0b" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyeodh</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapely </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> localtileserver <span class="im">import</span> TileClient</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.distributed</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> requests <span class="im">import</span> HTTPError</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> BytesIO </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> odc.stac <span class="im">import</span> configure_rio, stac_load <span class="co"># the data cube bit</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#import shapely.geometry</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Having imported the necessary libraries the next task is to set up the locations of the areas of interest. Having created the AOI points the user needs to connect to the Resource Catalogue so that they can start to find some data.</p>
<div id="dc5ce9fc" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Areas of Interest</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rut_pnt <span class="op">=</span> shapely.Point(<span class="op">-</span><span class="fl">0.683261054299237</span>, <span class="fl">52.672193937442586</span>) <span class="co"># a site near Rutland</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>thet_pnt <span class="op">=</span> shapely.Point(<span class="fl">0.6715892933273722</span>, <span class="fl">52.414471075812315</span>) <span class="co"># a site near Thetford</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="58d3bc99" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional cell</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If you want to see these points on a map run this cell</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map (m) centered between the two points</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (rut_pnt.y <span class="op">+</span> thet_pnt.y) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>center_lon <span class="op">=</span> (rut_pnt.x <span class="op">+</span> thet_pnt.x) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[center_lat, center_lon], zoom_start<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add markers for each point</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>folium.Marker([rut_pnt.y, rut_pnt.x], popup<span class="op">=</span><span class="st">"Rutland Site"</span>, icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">"blue"</span>)).add_to(m)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>folium.Marker([thet_pnt.y, thet_pnt.x], popup<span class="op">=</span><span class="st">"Thetford Site"</span>, icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">"green"</span>)).add_to(m)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Display the map</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e7b87e49" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to the Hub</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pyeodh.Client().get_catalog_service()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a list of the collections held in the Resource Catalogue (their id and description).</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># As the Resource Catalogue fills and development continues, the number of collections and the richness of their descriptions will increase</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> collect <span class="kw">in</span> client.get_collections():</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>collect<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>collect<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cmip6: CMIP6
cordex: CORDEX
ukcp: UKCP
defra-airbus: A collection of Airbus data for the DEFRA use case.
defra-planet: A collection of Planet data for the DEFRA use case.
airbus_sar_data: The German TerraSAR-X / TanDEM-X satellite formation and the Spanish PAZ satellite (managed by Hisdesat Servicios Estratégicos S.A.) are being operated in the same orbit tube and feature identical ground swaths and imaging modes - allowing Airbus and Hisdesat to establish a unique commercial Radar Constellation. The satellites carry a high frequency X-band Synthetic Aperture Radar (SAR) sensor in order to acquire datasets ranging from very high-resolution imagery to wide area coverage.
airbus_data_example: Airbus data
sentinel2_ard: sentinel 2 ARD
sentinel1: Sentinel 1
naip: The [National Agriculture Imagery Program](https://www.fsa.usda.gov/programs-and-services/aerial-photography/imagery-programs/naip-imagery/) (NAIP) provides U.S.-wide, high-resolution aerial imagery, with four spectral bands (R, G, B, IR).  NAIP is administered by the [Aerial Field Photography Office](https://www.fsa.usda.gov/programs-and-services/aerial-photography/) (AFPO) within the [US Department of Agriculture](https://www.usda.gov/) (USDA).  Data are captured at least once every three years for each state.  This dataset represents NAIP data from 2010-present, in [cloud-optimized GeoTIFF](https://www.cogeo.org/) format.
</code></pre>
</div>
</div>
<div id="ec9dc811" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The next thing to do is find some open data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For this presentation we want to find Sentinel-2 analysis ready (ARD) imagery near Rutland</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First we just want to understand some of the parameters linked to the data collection</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We will just print the first 5 records and the dataset temporal extent   </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>sentinel2_ard <span class="op">=</span> client.get_catalog(<span class="st">"supported-datasets/ceda-stac-fastapi"</span>).get_collection(<span class="st">'sentinel2_ard'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>sentinel2_ard.get_items()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>lim <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> sentinel2_ard.get_items():</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> lim:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(item.<span class="bu">id</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'DATASET TEMPORAL EXTENT: '</span>, [<span class="bu">str</span>(d) <span class="cf">for</span> d <span class="kw">in</span> sentinel2_ard.extent.temporal.intervals[<span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>neodc.sentinel_ard.data.sentinel_2.2023.11.21.S2B_20231121_latn536lonw0052_T30UUE_ORB123_20231121122846_utm30n_TM65
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn563lonw0037_T30VVH_ORB037_20231120132420_utm30n_osgb
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn546lonw0037_T30UVF_ORB037_20231120132420_utm30n_osgb
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn536lonw0007_T30UXE_ORB037_20231120132420_utm30n_osgb
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn528lonw0022_T30UWD_ORB037_20231120132420_utm30n_osgb
DATASET TEMPORAL EXTENT:  ['2023-01-01 11:14:51+00:00', '2023-11-01 11:43:49+00:00']</code></pre>
</div>
</div>
<div id="6cfe921d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To find out information about all the imagery in the collection then use this cell</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It undertakes a search for specific date ranges (November 2023) and limits the pagination return to 10</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>item_search <span class="op">=</span> client.search(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'sentinel2_ard'</span>],</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    catalog_paths<span class="op">=</span>[<span class="st">"supported-datasets/ceda-stac-fastapi"</span>],</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>[</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start_datetime&gt;=2023-11-01'</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'end_datetime&lt;=2023-11-30'</span>, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The item id and start time of image capture can be printed</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># If end time is also required, add the following code to the print statement: item.properties["end_datetime"]  </span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> item_search:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(item.<span class="bu">id</span>, item.properties[<span class="st">"start_datetime"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>neodc.sentinel_ard.data.sentinel_2.2023.11.21.S2B_20231121_latn536lonw0052_T30UUE_ORB123_20231121122846_utm30n_TM65 2023-11-21T11:43:49+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn563lonw0037_T30VVH_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn546lonw0037_T30UVF_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn536lonw0007_T30UXE_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn528lonw0022_T30UWD_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn527lonw0007_T30UXD_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn519lonw0037_T30UVC_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn519lonw0022_T30UWC_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn518lonw0008_T30UXC_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.20.S2A_20231120_latn510lonw0036_T30UVB_ORB037_20231120132420_utm30n_osgb 2023-11-20T11:23:51+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.18.S2B_20231118_latn554lonw0053_T30UUG_ORB080_20231118122250_utm30n_osgb 2023-11-18T11:33:19+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.17.S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb 2023-11-17T11:13:31+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.17.S2A_20231117_latn519lone0023_T31UDT_ORB137_20231117131218_utm31n_osgb 2023-11-17T11:13:31+00:00
neodc.sentinel_ard.data.sentinel_2.2023.11.17.S2A_20231117_latn509lone0009_T31UCS_ORB137_20231117131218_utm31n_osgb 2023-11-17T11:13:31+00:00</code></pre>
</div>
</div>
<div id="ba67740f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To find specific imagery for the Rutland site we need to add the intersects parameter. We set this to be our AOI point.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also filter the search by cloud cover, in this case limiting our search to images with less than 50% cloud in them</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> client.search(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'sentinel2_ard'</span>],</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    catalog_paths<span class="op">=</span>[<span class="st">"supported-datasets/ceda-stac-fastapi"</span>],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>rut_pnt,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>[</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start_datetime&gt;=2023-11-01'</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'end_datetime&lt;=2023-11-30'</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Cloud Coverage Assessment&lt;=50.0'</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># We can then count the number of items returned by the search </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Number of items found: '</span>, items.total_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of items found:  2</code></pre>
</div>
</div>
<div id="a830d3de" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the purposes of this presentation we will look at the second record ([1]) in more detail</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First we need to understand what information we can access</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> items[<span class="dv">1</span>].to_dict()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a.keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys(['type', 'stac_version', 'id', 'properties', 'geometry', 'links', 'assets', 'bbox', 'stac_extensions', 'collection'])</code></pre>
</div>
</div>
<div id="f1f20ff1" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data we want to access is stored under the 'assets' key. But what information is held in that? </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> (a[<span class="st">'assets'</span>]):</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cloud
cloud_probability
cog
metadata
saturated_pixels
thumbnail
topographic_shadow
valid_pixels</code></pre>
</div>
</div>
<div id="02aee937" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can get the link to each of the different assets</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> items[<span class="dv">1</span>].assets.items():</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key, value.href)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cloud https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_clouds.tif
cloud_probability https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_clouds_prob.tif
cog https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref.tif
metadata https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref_meta.xml
saturated_pixels https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_sat.tif
thumbnail https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref_thumbnail.jpg
topographic_shadow https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_toposhad.tif
valid_pixels https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_valid.tif</code></pre>
</div>
</div>
<div id="a386c2e7" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can use this information to view the image thumbnail</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>asset_dict <span class="op">=</span> items[<span class="dv">1</span>].assets</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the url as a string</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>thumbnail_assets <span class="op">=</span> [v <span class="cf">for</span> k, v <span class="kw">in</span> asset_dict.items() <span class="cf">if</span> <span class="st">'thumbnail'</span> <span class="kw">in</span> k]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>thumbnail_url <span class="op">=</span> thumbnail_assets[<span class="dv">0</span>].href</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we open the remote URL, read the data and dislay the thumbnail </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> urllib.request.urlopen(thumbnail_url) <span class="im">as</span> url:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(BytesIO(url.read()))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>display(img)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3_202409_Defra_DataAnalysis_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This shows that we can relatively easily interrogate the Resource Catalogue and filter the results so that we can find the data we require in the EODH. With a bit of tweaking of the code the user could also generate a list of assets and accompanying URLs to the datasets (for this and other datasets).</p>
<p>Now our use wants to see what commercial data exists for Thetford</p>
<div id="c8eae423" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find some commercial data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> collect <span class="kw">in</span> client.get_collections():</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'defra'</span> <span class="kw">in</span> collect.<span class="bu">id</span>: </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>collect<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>collect<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>defra-airbus: A collection of Airbus data for the DEFRA use case.
defra-planet: A collection of Planet data for the DEFRA use case.</code></pre>
</div>
</div>
<div id="fa4f1fb9" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's search for information on the Planet holdings  </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>planet <span class="op">=</span> client.get_catalog(<span class="st">"supported-datasets/defra"</span>).get_collection(<span class="st">'defra-planet'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>planet.get_items()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>lim <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> planet.get_items():</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> lim:</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(item.<span class="bu">id</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'PLANET DATASET TEMPORAL EXTENT: '</span>, [<span class="bu">str</span>(d) <span class="cf">for</span> d <span class="kw">in</span> planet.extent.temporal.intervals[<span class="dv">0</span>]])</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2024-08-23_strip_7527622_composite
2024-08-23_strip_7527462_composite
PLANET DATASET TEMPORAL EXTENT:  ['2024-08-23 11:09:19.358417+00:00', '2024-08-23 11:24:40.991786+00:00']</code></pre>
</div>
</div>
<div id="1dea4ff0" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To find specific imagery for the Thetford site we need to add the intersects parameter. We set this to be our AOI point.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>items1 <span class="op">=</span> client.search(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'defra-planet'</span>],</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    catalog_paths<span class="op">=</span>[<span class="st">"supported-datasets/defra"</span>],</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>thet_pnt,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>items2 <span class="op">=</span> client.search(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'defra-airbus'</span>],</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    catalog_paths<span class="op">=</span>[<span class="st">"supported-datasets/defra"</span>],</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>thet_pnt,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># We can then count the number of items returned by the search </span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Number of Planet items found: '</span>, items1.total_count)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Number of Airbus items found: '</span>, items2.total_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Planet items found:  1
Number of Airbus items found:  2</code></pre>
</div>
</div>
<div id="aa8ae86e" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> items1[<span class="dv">0</span>].assets.items():</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Planet: '</span>, key, value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Planet:  data &lt;Asset href=2024-08-23_strip_7527462_composite_file_format.tif&gt;
Planet:  udm2 &lt;Asset href=2024-08-23_strip_7527462_composite_udm2_file_format.tif&gt;</code></pre>
</div>
</div>
</section>
<section id="todo" class="level1">
<h1>TODO!!!!</h1>
</section>
<section id="display-an-image" class="level1">
<h1>DISPLAY AN IMAGE</h1>
</section>
<section id="eodh-its-massive-compute" class="level1">
<h1>EODH: it’s massive compute</h1>
<p>The EODH compute architecture is built around a new OGC standard called EO Application Packages (EOAP). These are complex constructions of code and data, and at their core is the concept of a Common Workflow Language (CWL) workflow. To run CWL workflows you need a CWL runner, and the EODH Workflow Runner provides that. The EOAPs require a workflow description in CWL, a Docker container, bespoke scripts and links to the data. In the case of EODH, the data inputs and outputs are to be provided as STAC catalogues. Oxidian, as part of our work developing integrations for the Hub, have created a generator tool <code>eoap-gen</code> that abstracts away much of the complexity (check out the training materials repository and website for more details).</p>
<p>Oxidian have also developed a QGIS plugin to allow desktop users to discover, parameterise and execute workflows on the Hub.</p>
<div id="4af41382" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First the user needs to connect to the Workflow Runner</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Currently this is done by obtaining a user account and API key from the core development team. Here, those details have been saved in secrets.txt</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'secrets.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> <span class="bu">file</span>.readlines()</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    username <span class="op">=</span> lines[<span class="dv">0</span>].strip().split(<span class="st">'='</span>)[<span class="dv">1</span>].strip(<span class="st">'"'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    token <span class="op">=</span> lines[<span class="dv">1</span>].strip().split(<span class="st">'='</span>)[<span class="dv">1</span>].strip(<span class="st">'"'</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>clientwfr <span class="op">=</span> pyeodh.Client(username<span class="op">=</span>username, token<span class="op">=</span>token, s3_token<span class="op">=</span>token)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>wfr <span class="op">=</span> clientwfr.get_ades()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our user wants to know what workflows they have access to in their workspace on the Hub.</p>
<div id="bdeaf290" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the workflows available in the user workspace</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> wfr.get_processes():</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(p.<span class="bu">id</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>display
echo
convert-img</code></pre>
</div>
</div>
<p>As development continues the number of demonstration workflows available to users will increase. With uptake of the generator tool users will also be able to create their own bespoke workflows. In time, the Hub will contain organisational accounts and the ability to share workflow files.</p>
<p>Our user wants to deploy a workflow that they have found online. They can do so for compliant CWL files by submitting the URl.</p>
<div id="cca81b87" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy a workflow using a URL to a .cwl file hosted online</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>convert_url_proc <span class="op">=</span> wfr.deploy_process(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    cwl_url<span class="op">=</span><span class="st">"https://raw.githubusercontent.com/EOEPCA/deployment-guide/main/deploy/samples/requests/processing/convert-url-app.cwl"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(convert_url_proc.<span class="bu">id</span>, convert_url_proc.description, <span class="st">": Deployed"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">''</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List the available workflows</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> wfr.get_processes():</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(p.<span class="bu">id</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>convert-url Convert URL : Deployed

display
echo
convert-img
convert-url</code></pre>
</div>
</div>
<div id="42d60cba" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If a user wants to tidy their workspace or no longer wants access to a workflow they can remove it</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    wfr.get_process(<span class="st">"convert-url"</span>).delete()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Process removed"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> HTTPError:</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Process not found"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Process removed</code></pre>
</div>
</div>
<p>The user is interested in the ARD files, but they are too large for the task that they want to undertake. The workflow file linked to <a href="https://github.com/figi44/eoap/blob/main/resize-collection.cwl">here</a> takes a series of data from the Sentinel 2 ARD collection and resizes the imagery using gdal_translate. The CWL file needs to be submitted to the Workflow Runner and parameterised, before it can then be run.</p>
<div id="bcc09f5e" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy the workflow</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove an existing nstance of the workflow</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    wfr.get_process(<span class="st">"convert-img"</span>).delete()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Process removed"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> HTTPError:</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Process not found"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy from a URL to a .cwl file hosted online</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#img_proc = wfr.deploy_process(cwl_yaml=cwl_yaml)</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>img_proc <span class="op">=</span> wfr.deploy_process(cwl_url<span class="op">=</span><span class="st">'https://raw.githubusercontent.com/ajgwords/eodh-tests/main/resize-col.cwl'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(img_proc.<span class="bu">id</span>, img_proc.description, <span class="st">": Deployed"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">''</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># List the available workflows</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> wfr.get_processes():</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(p.<span class="bu">id</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Process not found
resize-col Resize collection cogs : Deployed

display
echo
resize-col</code></pre>
</div>
</div>
<p>Once the CWL file has been submitted then it is possible for users with suitable permissions to also view the list of available workflows through the QGIS plugin.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="3_202409_Defra_DataAnalysis_files/figure-html/59b0a201-1-image.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>The user can choose and parameterise a workflow using the QGIS plugin as shown in this screenshot. A series of defaults are provided with all workflow files so a user can run the workflow straight away using those. To do so in code, the user provides an empty dictionary.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="3_202409_Defra_DataAnalysis_files/figure-html/dd9122a5-1-image.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<div id="a2087c93" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the workflow using the defaults</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pyeodh.set_log_level(<span class="dv">10</span>) <span class="co"># set the logging to be verbose</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>resize_job <span class="op">=</span> img_proc.execute(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(resize_job.<span class="bu">id</span>, resize_job.status, resize_job.message)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>DEBUG: _request_json_raw received {'self': &lt;pyeodh.client.Client object at 0x7d35e47e45c0&gt;, 'method': 'POST', 'url': 'https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/processes/resize-col/execution', 'headers': {'Prefer': 'respond-async'}, 'params': None, 'data': {'inputs': {'workspace': 'ajgwords'}}, 'encode': &lt;function _encode_json at 0x7d3635f30540&gt;}
DEBUG: Making request: POST https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/processes/resize-col/execution
       headers: {'Prefer': 'respond-async', 'Content-Type': 'application/json'}
       params: None
       body: {"inputs": {"workspace": "ajgwords"}}
DEBUG: Received response 201
       headers: {'Content-Type': 'application/json;charset=UTF-8', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'Server': 'nginx/1.27.0', 'Date': 'Wed, 18 Sep 2024 14:05:46 GMT', 'x-powered-by': 'ZOO-Project-DRU', 'x-also-powered-by': 'jwt.securityIn', 'x-also-also-powered-by': 'dru.securityIn', 'preference-applied': 'respond-async', 'x-also-also-also-powered-by': 'dru.securityOut', 'location': 'https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/jobs/19efd624-75c7-11ef-9849-4e9264aaf6f3', 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Credentials': 'true', 'Access-Control-Allow-Methods': 'GET, PUT, POST, DELETE, PATCH, OPTIONS', 'Access-Control-Allow-Headers': 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,Prefer', 'Access-Control-Max-Age': '1728000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 a6a1a17bbe377bf7c4423397c71959da.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'LHR50-P1', 'X-Amz-Cf-Id': 'RtavU9ppINxjxyCvlYOnhxdNqGnDtX-HNJmyLlCbtYPf3Dcd5MgLsg=='}
       content: {
         "jobID": "19efd624-75c7-11ef-9849-4e9264aaf6f3",
         "type": "process",
         "processID": "resize-col",
         "created": "2024-09-18T14:05:46.805Z",
         "started": "2024-09-18T14:05:46.805Z",
         "updated": "2024-09-18T14:05:46.805Z",
         "status": "running",
         "message": "ZOO-Kernel accepted to run your service!",
         "links": [
           {
             "title": "Status location",
             "rel": "monitor",
             "type": "application/json",
             "href": "https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/jobs/19efd624-75c7-11ef-9849-4e9264aaf6f3"
           }
         ]
       }</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>19efd624-75c7-11ef-9849-4e9264aaf6f3 running ZOO-Kernel accepted to run your service!</code></pre>
</div>
</div>
<div id="c7458b6c" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>resize_job.refresh()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(resize_job.<span class="bu">id</span>, resize_job.status, resize_job.message)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>DEBUG: _request_json_raw received {'self': &lt;pyeodh.client.Client object at 0x7d35e47e45c0&gt;, 'method': 'GET', 'url': 'https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/jobs/19efd624-75c7-11ef-9849-4e9264aaf6f3', 'headers': None, 'params': None, 'data': None, 'encode': &lt;function _encode_json at 0x7d3635f30540&gt;}
DEBUG: Making request: GET https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/jobs/19efd624-75c7-11ef-9849-4e9264aaf6f3
       headers: {}
       params: None
       body: None
DEBUG: Received response 200
       headers: {'Content-Type': 'application/json;charset=UTF-8', 'Content-Length': '507', 'Connection': 'keep-alive', 'Server': 'nginx/1.27.0', 'Date': 'Wed, 18 Sep 2024 14:05:54 GMT', 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Credentials': 'true', 'Access-Control-Allow-Methods': 'GET, PUT, POST, DELETE, PATCH, OPTIONS', 'Access-Control-Allow-Headers': 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,Prefer', 'Access-Control-Max-Age': '1728000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 a6a1a17bbe377bf7c4423397c71959da.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'LHR50-P1', 'X-Amz-Cf-Id': 'IakHOzKo8AnbmuIW_lFytmYjofpvygKjKotlpOjxhGiQ-a5G6RH22A=='}
       content: {"progress": 15, "jobID": "19efd624-75c7-11ef-9849-4e9264aaf6f3", "type": "process", "processID": "resize-col", "created": "2024-09-18T14:05:46.805Z", "started": "2024-09-18T14:05:46.805Z", "updated": "2024-09-18T14:05:48.804Z", "status": "running", "message": "processing environment created, preparing execution", "links": [{"title": "Status location", "rel": "monitor", "type": "application/json", "href": "https://test.eodatahub.org.uk/ades/ajgwords/ogc-api/jobs/19efd624-75c7-11ef-9849-4e9264aaf6f3"}]}</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>19efd624-75c7-11ef-9849-4e9264aaf6f3 running processing environment created, preparing execution</code></pre>
</div>
</div>
<p>The outputs above show the status of the running job: <code>"status": "running"</code>. The job status can also be monitored using the QGIS plugin.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="3_202409_Defra_DataAnalysis_files/figure-html/90492ffa-4-image.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="3_202409_Defra_DataAnalysis_files/figure-html/90492ffa-1-image-2.png" class="img-fluid figure-img"></p>
<figcaption>image-2.png</figcaption>
</figure>
</div>
<p>The outputs are accessible and loadable from the QGIS plugin.</p>
<p>Original image: <img src="3_202409_Defra_DataAnalysis_files/figure-html/90492ffa-2-image-3.png" class="img-fluid" alt="image-3.png"> Resampled image: <img src="3_202409_Defra_DataAnalysis_files/figure-html/90492ffa-3-image-4.png" class="img-fluid" alt="image-4.png"></p>
</section>
<section id="eodh-its-data-analysis" class="level1">
<h1>EODH: it’s data analysis</h1>
<p>Notebook service can be used with pyeodh and other libraries installed using pip to analyse data and outputs</p>
<div id="25d0b682" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> localtileserver <span class="im">import</span> TileClient</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#data_url = 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref.tif'</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span> <span class="op">=</span> TileClient(<span class="st">'data/S2A_clip_rend.tif'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#map = TileClient(data_url)</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/al/miniforge3/envs/eodh/lib/python3.12/site-packages/rio_tiler/io/rasterio.py:130: NoOverviewWarning: The dataset has no Overviews. rio-tiler performances might be impacted.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5c5964e7fc9147b28246ee0bed10af8b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="4bd21a11" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a[<span class="st">'assets'</span>][<span class="st">'cog'</span>][<span class="st">'href'</span>])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> (a[<span class="st">'assets'</span>][<span class="st">'cog'</span>][<span class="st">'eo:bands'</span>]):</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>s2url <span class="op">=</span> (a[<span class="st">'assets'</span>][<span class="st">'cog'</span>][<span class="st">'href'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6ab582f3" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Define the URL of the Cloud Optimized GeoTIFF (COG)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>cog_path <span class="op">=</span> <span class="st">"https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/11/17/S2A_20231117_latn527lonw0007_T30UXD_ORB137_20231117131218_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref.tif"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the image as an xarray dataset</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> rioxarray.open_rasterio(cog_path)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Define the clipping area (bounding box) in the same CRS as the image</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the minx, miny, maxx, maxy to your area of interest</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>minx, miny, maxx, maxy <span class="op">=</span> <span class="dv">481682</span>, <span class="dv">296841</span>, <span class="dv">512343</span>, <span class="dv">313344</span>  <span class="co"># Example bounds in UTM</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> box(minx, miny, maxx, maxy)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the bounding box into a GeoDataFrame</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>geo_df <span class="op">=</span> gpd.GeoDataFrame({<span class="st">'geometry'</span>: [bbox]}, crs<span class="op">=</span>data.rio.crs)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Clip the data using the bounding box (rioxarray will handle the masking)</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>clipped_data <span class="op">=</span> data.rio.clip(geo_df.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.__geo_interface__), geo_df.crs)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="eae2659e" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Select three bands for RGB visualization</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming band 1 = Blue, band 2 = Green, band 3 = Red</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the specific band indexes based on your data</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>red_band <span class="op">=</span> clipped_data.sel(band<span class="op">=</span><span class="dv">3</span>)  <span class="co"># Select the Red band (band index 3)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>green_band <span class="op">=</span> clipped_data.sel(band<span class="op">=</span><span class="dv">2</span>)  <span class="co"># Select the Green band (band index 2)</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>blue_band <span class="op">=</span> clipped_data.sel(band<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Select the Blue band (band index 1)</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Normalize the bands for display (values between 0 and 255)</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_band(band):</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    band_min, band_max <span class="op">=</span> band.<span class="bu">min</span>(), band.<span class="bu">max</span>()</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((band <span class="op">-</span> band_min) <span class="op">/</span> (band_max <span class="op">-</span> band_min) <span class="op">*</span> <span class="dv">255</span>).astype(np.uint8)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the selected bands</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>red_norm <span class="op">=</span> normalize_band(red_band)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>green_norm <span class="op">=</span> normalize_band(green_band)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>blue_norm <span class="op">=</span> normalize_band(blue_band)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Stack the three bands into an RGB image</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>rgb_image <span class="op">=</span> np.dstack([red_norm, green_norm, blue_norm])</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 7: Convert the NumPy array to a PIL image</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>pil_image <span class="op">=</span> Image.fromarray(rgb_image)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 8: Display the image using PIL or matplotlib</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>pil_image.show()</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, display with matplotlib</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>plt.imshow(rgb_image)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Clipped RGB Satellite Image"</span>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="towards-a-data-cube" class="level3">
<h3 class="anchored" data-anchor-id="towards-a-data-cube">Towards a data cube?</h3>
<p>Following https://odc-stac.readthedocs.io/en/latest/notebooks/stac-load-e84-aws.html</p>
<div id="4f6938e0-7978-4ead-abe2-470f9dc2ed18" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_bounds(bbox, invert_y<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Helper method for changing bounding box representation to leaflet notation</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ``(lon1, lat1, lon2, lat2) -&gt; ((lat1, lon1), (lat2, lon2))``</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    x1, y1, x2, y2 <span class="op">=</span> bbox</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> invert_y:</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        y1, y2 <span class="op">=</span> y2, y1</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((y1, x1), (y2, x2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6c32de54-6db4-4417-ad3b-b4e21aea34b7" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIND STAC ITEMS</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#catalog = Client.open("https://earth-search.aws.element84.com/v1/")</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://api.stac.ceda.ac.uk/"</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> Client.<span class="bu">open</span>(url)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> coll <span class="kw">in</span> client.get_collections():</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>coll<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coll<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cmip6: CMIP6
cordex: CORDEX
land_cover: land_cover
sentinel1: Sentinel 1
sentinel2_ard: sentinel 2 ARD
sst-cdrv3-collection: collection of EOCIS SST CDR V3
ukcp: UKCP</code></pre>
</div>
</div>
<div id="2f466597-5f83-448b-8377-fe4d847b17a5" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sentinel2_ard <span class="op">=</span> client.get_collection(<span class="st">'sentinel2_ard'</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>sentinel2_ard.get_items()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check the spatial and temporal extent of the collection</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"spatial extent:"</span>, sentinel2_ard.extent.spatial.bboxes)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"data range:"</span>, [<span class="bu">str</span>(d) <span class="cf">for</span> d <span class="kw">in</span> sentinel2_ard.extent.temporal.intervals[<span class="dv">0</span>]])</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">#items = list(query.items())</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"Found: {len(items):d} datasets")</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert STAC items into a GeoJSON FeatureCollection</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">#stac_json = query.item_collection_as_dict()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spatial extent: [[-9.00034454651177, 49.48562028352171, 3.1494256015866995, 61.33444247301668]]
data range: ['2023-01-01 11:14:51+00:00', '2023-11-01 11:43:49+00:00']</code></pre>
</div>
</div>
<div id="ac056347-5fb2-4e95-98ed-57ec504928e4" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SEARCH</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>item_search <span class="op">=</span> client.search(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'sentinel2_ard'</span>],</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>[</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start_datetime&gt;=2023-01-01'</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'end_datetime&lt;=2023-02-28'</span>, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    max_items<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6181ff28-d4e8-403e-bd8c-35003661c945" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> <span class="bu">list</span>(item_search.items())</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(items)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>100</code></pre>
</div>
</div>
<div id="6126f122-5c38-43f6-98f7-af8f19c39051" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from shapely import Point</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#point = Point(-1.3144835766058023, 51.57555380377267) # Atlas building at RAL</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>item_search <span class="op">=</span> client.search(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'sentinel2_ard'</span>],</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>rut_pnt,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>[</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start_datetime&gt;=2023-01-01'</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'end_datetime&lt;=2023-02-28'</span>, </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>      ],</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    max_items<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> <span class="bu">list</span>(item_search.items())</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>[&lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.02.25.S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.02.23.S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.02.20.S2A_20230220_lat53lon071_T30UXD_ORB137_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.02.15.S2B_20230215_lat53lon071_T30UXD_ORB137_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.02.13.S2A_20230213_lat53lon071_T30UXD_ORB037_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.02.08.S2B_20230208_lat53lon071_T30UXD_ORB037_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.01.31.S2A_20230131_lat53lon071_T30UXD_ORB137_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.01.29.S2B_20230129_lat53lon071_T30UXD_ORB037_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.01.26.S2B_20230126_lat53lon071_T30UXD_ORB137_utm30n_osgb&gt;,
 &lt;Item id=neodc.sentinel_ard.data.sentinel_2.2023.01.24.S2A_20230124_lat53lon071_T30UXD_ORB037_utm30n_osgb&gt;]</code></pre>
</div>
</div>
<div id="758e6914-8f2f-4098-b4ae-d7039675c6ec" class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>items[<span class="dv">0</span>].to_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5f1725d7-e500-47a5-9bae-9a30344d2770" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>item_search <span class="op">=</span> client.search(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">'sentinel2_ard'</span>],</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>point,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>[</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start_datetime&gt;=2023-01-01'</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'end_datetime&lt;=2023-02-28'</span>, </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'eo:cloud_cover&lt;=50.0'</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>      ],</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    max_items<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> <span class="bu">list</span>(item_search.items())</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="44902e7b-b2bf-44c4-bd37-469c17396949" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>items[<span class="dv">0</span>].to_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>{'type': 'Feature',
 'stac_version': '1.0.0',
 'id': 'neodc.sentinel_ard.data.sentinel_2.2023.02.25.S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb',
 'properties': {'file_count': 7,
  'start_datetime': '2023-02-25T11:09:39Z',
  'end_datetime': '2023-02-25T11:09:39Z',
  'NSSDC Identifier': '2015-000A',
  'created': '2024-02-07T11:36:34.672255Z',
  'Instrument Family Name': 'Multi-Spectral Instrument',
  'Platform Number': '2B',
  'Datatake Type': 'INS-NOBS',
  'esa_file_name': 'S2B_MSIL1C_20230225T110939_N0509_R137_T30UXD_20230225T115203',
  'Ground Tracking Direction': 'descending',
  'datetime': '2023-02-25T11:09:39Z',
  'instance_id': 'neodc.sentinel_ard.data.sentinel_2.2023.02.25.S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb',
  'size': 1960567691,
  'Product Type': 'S2MSI1C',
  'Instrument Family Name Abbreviation': 'MSI',
  'Start Orbit Number': '031194',
  'eo:cloud_cover': '84.3860969273493',
  'Start Relative Orbit Number': '137',
  'updated': '2024-02-07T11:36:34.672255Z',
  'Instrument Mode': None,
  'EPSG': '27700'},
 'geometry': {'coordinates': [[[-1.5015259, 53.24020834947074],
    [0.141769904481162, 53.20820137275637],
    [0.071678487044592, 52.22256603361336],
    [-1.5350342, 52.25345680664421],
    [-1.5015259, 53.24020834947074]]],
  'type': 'Polygon'},
 'links': [{'rel': 'self',
   'href': 'https://api.stac.ceda.ac.uk/collections/sentinel2_ard/items/neodc.sentinel_ard.data.sentinel_2.2023.02.25.S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb',
   'type': 'application/geo+json'},
  {'rel': 'parent',
   'href': 'https://api.stac.ceda.ac.uk/collections/sentinel2_ard',
   'type': 'application/json'},
  {'rel': 'collection',
   'href': 'https://api.stac.ceda.ac.uk/collections/sentinel2_ard',
   'type': 'application/json'},
  {'rel': 'root',
   'href': 'https://api.stac.ceda.ac.uk/',
   'type': 'application/json',
   'title': 'stac-fastapi-elasticsearch'}],
 'assets': {'cloud': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_clouds.tif',
   'size': 1348575,
   'location': 'on_disk',
   'roles': ['data']},
  'metadata': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref_meta.xml',
   'size': 18363,
   'location': 'on_disk',
   'roles': ['metadata']},
  'thumbnail': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref_thumbnail.jpg',
   'size': 70539,
   'location': 'on_disk',
   'roles': ['thumbnail']},
  'topographic_shadow': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_toposhad.tif',
   'size': 241186,
   'location': 'on_disk',
   'roles': ['data']},
  'cog': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref.tif',
   'size': 1956895150,
   'eo:bands': [{'full_width_half_max': 0.07,
     'central_wavelength': 492.1,
     'name': 'B02',
     'description': 'Blue',
     'common_name': 'blue'},
    {'full_width_half_max': 0.04,
     'central_wavelength': 559,
     'name': 'B03',
     'description': 'Green',
     'common_name': 'green'},
    {'full_width_half_max': 0.03,
     'central_wavelength': 665,
     'name': 'B04',
     'description': 'Red',
     'common_name': 'red'},
    {'full_width_half_max': 0.02,
     'central_wavelength': 703.8,
     'name': 'B05',
     'description': 'Visible and Near Infrared',
     'common_name': 'rededge'},
    {'full_width_half_max': 0.02,
     'central_wavelength': 739.1,
     'name': 'B06',
     'description': 'Visible and Near Infrared',
     'common_name': 'rededge'},
    {'full_width_half_max': 0.02,
     'central_wavelength': 779.7,
     'name': 'B07',
     'description': 'Visible and Near Infrared',
     'common_name': 'rededge'},
    {'full_width_half_max': 0.11,
     'central_wavelength': 833,
     'name': 'B08',
     'description': 'Visible and Near Infrared',
     'common_name': 'nir'},
    {'full_width_half_max': 0.02,
     'central_wavelength': 864,
     'name': 'B08a',
     'description': 'Visible and Near Infrared',
     'common_name': 'nir08'},
    {'full_width_half_max': 0.09,
     'central_wavelength': 1610.4,
     'name': 'B11',
     'description': 'Short Wave Infrared',
     'common_name': 'swir16'},
    {'full_width_half_max': 0.19,
     'central_wavelength': 2185.7,
     'name': 'B12',
     'description': 'Short Wave Infrared',
     'common_name': 'swir22'}],
   'location': 'on_disk',
   'roles': ['data']},
  'valid_pixels': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_valid.tif',
   'size': 288519,
   'location': 'on_disk',
   'roles': ['data']},
  'saturated_pixels': {'href': 'https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/25/S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb_sat.tif',
   'size': 1705359,
   'location': 'on_disk',
   'roles': ['data']}},
 'bbox': [-1.5350342, 52.22256603361336, 0.141769904481162, 53.24020834947074],
 'stac_extensions': ['https://stac-extensions.github.io/eo/v1.1.0/schema.json'],
 'collection': 'sentinel2_ard'}</code></pre>
</div>
</div>
<div id="0288e451-47c0-4b19-b770-e80dcac7b120" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> items[<span class="dv">1</span>].assets.items():</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key, value.href)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cloud https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_clouds.tif
metadata https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref_meta.xml
thumbnail https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref_thumbnail.jpg
topographic_shadow https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_toposhad.tif
cog https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_vmsk_sharp_rad_srefdem_stdsref.tif
valid_pixels https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_valid.tif
saturated_pixels https://dap.ceda.ac.uk/neodc/sentinel_ard/data/sentinel_2/2023/02/23/S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb_sat.tif</code></pre>
</div>
</div>
<div id="407a59ad-1f16-4e16-9051-0abeb3cd1b27" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SET UP DASK CLIENT</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>client3 <span class="op">=</span> dask.distributed.Client()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>configure_rio(cloud_defaults<span class="op">=</span><span class="va">True</span>, aws<span class="op">=</span>{<span class="st">"aws_unsigned"</span>: <span class="va">True</span>}, client<span class="op">=</span>client) <span class="co"># sets up gdal for cloud use</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>display(client3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;" class="anchored">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-be9a6db2-75ca-11ef-bf9a-f40669402fbd</p>
        
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
<td style="text-align: left;"><strong>Cluster type:</strong> distributed.LocalCluster</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


        

        
            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;" class="anchored">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;" class="anchored">LocalCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">4dcb16e5</p>
        
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Workers:</strong> 4</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total threads:</strong> 4</td>
<td style="text-align: left;"><strong>Total memory:</strong> 15.48 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Status:</strong> running</td>
<td style="text-align: left;"><strong>Using processes:</strong> True</td>
</tr>
</tbody>
</table>


        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;" class="anchored">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;" class="anchored">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-db0af68a-d8f9-4a97-9546-ed5911dddf0c</p>
            
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:34791</td>
<td style="text-align: left;"><strong>Workers:</strong> 4</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Total threads:</strong> 4</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Started:</strong> Just now</td>
<td style="text-align: left;"><strong>Total memory:</strong> 15.48 GiB</td>
</tr>
</tbody>
</table>

        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;" class="anchored">Workers</h3>
        </summary>

        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 0</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:36473</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:36613/status" target="_blank">http://127.0.0.1:36613/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.87 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:34453</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-7uv32axl</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 1</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:34507</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:35983/status" target="_blank">http://127.0.0.1:35983/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.87 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:40119</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-wngmmuug</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 2</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:38845</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:38525/status" target="_blank">http://127.0.0.1:38525/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.87 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:46169</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-5_ey1q50</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 3</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:38677</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:44171/status" target="_blank">http://127.0.0.1:44171/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.87 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:45463</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-oialu_md</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        

    </details>
</div>

        </details>
    </div>
</div>
            </details>
        

    </div>
</div>
</div>
</div>
<div id="ea05ae8b-41f1-432a-a765-8e862ccbf92d" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found: </span><span class="sc">{</span><span class="bu">len</span>(items)<span class="sc">:d}</span><span class="ss"> datasets"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert STAC items into a GeoJSON FeatureCollection</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>stac_json <span class="op">=</span> item_search.item_collection_as_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found: 10 datasets</code></pre>
</div>
</div>
<div id="27f6e12a-93aa-4a70-8cd6-92232cd835a9" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># REVIEW SEARCH RESULTS</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MAYBE DELETE</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame.from_features(stac_json, <span class="st">"epsg:4326"</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute granule id from components</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#gdf["granule"] = (</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    gdf["esa_file_name"].apply(lambda x: f"{x:02d}")</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    + gdf["mgrs:latitude_band"]</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    + gdf["mgrs:grid_square"]</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> gdf.plot(</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"esa_file_name"</span>,</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    aspect<span class="op">=</span><span class="st">"equal"</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">12</span>),</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span>{<span class="st">"loc"</span>: <span class="st">"upper left"</span>, <span class="st">"frameon"</span>: <span class="va">False</span>, <span class="st">"ncol"</span>: <span class="dv">1</span>},</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> fig.set_title(<span class="st">"STAC Query Results"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3_202409_Defra_DataAnalysis_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="205e0c9a-3e03-48f4-b03a-b7873411827e" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PLOT THE SAME, but using FOLIUM</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/python-visualization/folium/issues/1501</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#from branca.element import Figure</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#import folium</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> folium.Figure(width<span class="op">=</span><span class="dv">600</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="dv">52</span>, <span class="dv">2</span>], zoom_start<span class="op">=</span><span class="dv">5</span>).add_to(f)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co">#fig = Figure(width="400px", height="500px")</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">#map1 = folium.Map()</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.add_child(map1)</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co">#folium.GeoJson(</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    shapely.geometry.box(*bbox),</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co">#    style_function=lambda x: dict(fill=False, weight=1, opacity=0.7, color="olive"),</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    name="Query",</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="co">#).add_to(m)</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>gdf.explore(</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"esa_file_name"</span>,</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"esa_file_name"</span>,</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"datetime"</span>,</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"eo:cloud_cover"</span>,</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span><span class="bu">dict</span>(fillOpacity<span class="op">=</span><span class="fl">0.1</span>, width<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"STAC"</span>,</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="co">#map1.fit_bounds(bounds=convert_bounds(gdf.unary_union.bounds))</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a><span class="co">#display(fig)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_21bbde2d72780ee684e1816f1071fb0e {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_21bbde2d72780ee684e1816f1071fb0e&quot; ></div>
        
</body>
<script>
    
    
            var map_21bbde2d72780ee684e1816f1071fb0e = L.map(
                &quot;map_21bbde2d72780ee684e1816f1071fb0e&quot;,
                {
                    center: [52.0, 2.0],
                    crs: L.CRS.EPSG3857,
                    zoom: 5,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_ed7bf94a8027364179187375b356aad4 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_ed7bf94a8027364179187375b356aad4.addTo(map_21bbde2d72780ee684e1816f1071fb0e);
        
    
        function geo_json_f2ea71130e2a0fcad8d49fedb72e2723_styler(feature) {
            switch(feature.id) {
                case &quot;0&quot;: 
                    return {&quot;color&quot;: &quot;#9edae5&quot;, &quot;fillColor&quot;: &quot;#9edae5&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;1&quot;: 
                    return {&quot;color&quot;: &quot;#9467bd&quot;, &quot;fillColor&quot;: &quot;#9467bd&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;2&quot;: 
                    return {&quot;color&quot;: &quot;#d62728&quot;, &quot;fillColor&quot;: &quot;#d62728&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;3&quot;: 
                    return {&quot;color&quot;: &quot;#dbdb8d&quot;, &quot;fillColor&quot;: &quot;#dbdb8d&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;4&quot;: 
                    return {&quot;color&quot;: &quot;#2ca02c&quot;, &quot;fillColor&quot;: &quot;#2ca02c&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;5&quot;: 
                    return {&quot;color&quot;: &quot;#c7c7c7&quot;, &quot;fillColor&quot;: &quot;#c7c7c7&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;6&quot;: 
                    return {&quot;color&quot;: &quot;#ff7f0e&quot;, &quot;fillColor&quot;: &quot;#ff7f0e&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;7&quot;: 
                    return {&quot;color&quot;: &quot;#f7b6d2&quot;, &quot;fillColor&quot;: &quot;#f7b6d2&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;8&quot;: 
                    return {&quot;color&quot;: &quot;#c49c94&quot;, &quot;fillColor&quot;: &quot;#c49c94&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                default:
                    return {&quot;color&quot;: &quot;#1f77b4&quot;, &quot;fillColor&quot;: &quot;#1f77b4&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
            }
        }
        function geo_json_f2ea71130e2a0fcad8d49fedb72e2723_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_f2ea71130e2a0fcad8d49fedb72e2723_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_f2ea71130e2a0fcad8d49fedb72e2723_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_f2ea71130e2a0fcad8d49fedb72e2723_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_f2ea71130e2a0fcad8d49fedb72e2723.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_f2ea71130e2a0fcad8d49fedb72e2723_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_f2ea71130e2a0fcad8d49fedb72e2723 = L.geoJson(null, {
                onEachFeature: geo_json_f2ea71130e2a0fcad8d49fedb72e2723_onEachFeature,
            
                style: geo_json_f2ea71130e2a0fcad8d49fedb72e2723_styler,
                pointToLayer: geo_json_f2ea71130e2a0fcad8d49fedb72e2723_pointToLayer,
        });

        function geo_json_f2ea71130e2a0fcad8d49fedb72e2723_add (data) {
            geo_json_f2ea71130e2a0fcad8d49fedb72e2723
                .addData(data);
        }
            geo_json_f2ea71130e2a0fcad8d49fedb72e2723_add({&quot;bbox&quot;: [-1.5350342, 52.22256603361336, 0.141769904481162, 53.24020834947074], &quot;features&quot;: [{&quot;bbox&quot;: [-1.5350342, 52.22256603361336, 0.141769904481162, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-1.5015259, 53.24020834947074], [0.141769904481162, 53.20820137275637], [0.071678487044592, 52.22256603361336], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2B&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;031194&quot;, &quot;Start Relative Orbit Number&quot;: &quot;137&quot;, &quot;__folium_color&quot;: &quot;#9edae5&quot;, &quot;created&quot;: &quot;2024-02-07T11:36:34.672255Z&quot;, &quot;datetime&quot;: &quot;2023-02-25T11:09:39Z&quot;, &quot;end_datetime&quot;: &quot;2023-02-25T11:09:39Z&quot;, &quot;eo:cloud_cover&quot;: &quot;84.3860969273493&quot;, &quot;esa_file_name&quot;: &quot;S2B_MSIL1C_20230225T110939_N0509_R137_T30UXD_20230225T115203&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.02.25.S2B_20230225_lat53lon071_T30UXD_ORB137_utm30n_osgb&quot;, &quot;size&quot;: 1960567691, &quot;start_datetime&quot;: &quot;2023-02-25T11:09:39Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:36:34.672255Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.238457465134104, -0.22167969, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-0.22167969, 53.2152805767136], [-0.26956177, 53.12913402969993], [-0.34890747, 52.985594372313415], [-0.4281006, 52.84207532865257], [-0.5065613, 52.69847356656665], [-0.58465576, 52.55489084661768], [-0.66223145, 52.41122956409288], [-0.73934937, 52.26747706637332], [-0.7548828, 52.238457465134104], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074], [-0.22167969, 53.2152805767136]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2A&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;040074&quot;, &quot;Start Relative Orbit Number&quot;: &quot;037&quot;, &quot;__folium_color&quot;: &quot;#9467bd&quot;, &quot;created&quot;: &quot;2024-02-07T11:35:43.130390Z&quot;, &quot;datetime&quot;: &quot;2023-02-23T11:21:11Z&quot;, &quot;end_datetime&quot;: &quot;2023-02-23T11:21:11Z&quot;, &quot;eo:cloud_cover&quot;: &quot;39.748452784987&quot;, &quot;esa_file_name&quot;: &quot;S2A_MSIL1C_20230223T112111_N0509_R037_T30UXD_20230223T145910&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.02.23.S2A_20230223_lat53lon071_T30UXD_ORB037_utm30n_osgb&quot;, &quot;size&quot;: 1249951397, &quot;start_datetime&quot;: &quot;2023-02-23T11:21:11Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:35:43.130390Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.22256603361336, 0.141769904481162, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-1.5015259, 53.24020834947074], [0.141769904481162, 53.20820137275637], [0.071678487044592, 52.22256603361336], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;2&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2A&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;040031&quot;, &quot;Start Relative Orbit Number&quot;: &quot;137&quot;, &quot;__folium_color&quot;: &quot;#d62728&quot;, &quot;created&quot;: &quot;2024-02-07T11:34:55.005529Z&quot;, &quot;datetime&quot;: &quot;2023-02-20T11:11:01Z&quot;, &quot;end_datetime&quot;: &quot;2023-02-20T11:11:01Z&quot;, &quot;eo:cloud_cover&quot;: &quot;33.8777807638329&quot;, &quot;esa_file_name&quot;: &quot;S2A_MSIL1C_20230220T111101_N0509_R137_T30UXD_20230220T131022&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.02.20.S2A_20230220_lat53lon071_T30UXD_ORB137_utm30n_osgb&quot;, &quot;size&quot;: 2011723188, &quot;start_datetime&quot;: &quot;2023-02-20T11:11:01Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:34:55.005529Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.535019632835204, 52.22256603361336, 0.141769904481162, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-1.501539571659072, 53.24020834947074], [0.141769904481162, 53.20820137275637], [0.071678487044592, 52.22256603361336], [-1.535019632835204, 52.25345680664421], [-1.501539571659072, 53.24020834947074]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;3&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2B&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;031051&quot;, &quot;Start Relative Orbit Number&quot;: &quot;137&quot;, &quot;__folium_color&quot;: &quot;#dbdb8d&quot;, &quot;created&quot;: &quot;2024-02-07T11:34:06.482346Z&quot;, &quot;datetime&quot;: &quot;2023-02-15T11:10:49Z&quot;, &quot;end_datetime&quot;: &quot;2023-02-15T11:10:49Z&quot;, &quot;eo:cloud_cover&quot;: &quot;0.126041386723999&quot;, &quot;esa_file_name&quot;: &quot;S2B_MSIL1C_20230215T111049_N0509_R137_T30UXD_20230215T115158&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.02.15.S2B_20230215_lat53lon071_T30UXD_ORB137_utm30n_osgb&quot;, &quot;size&quot;: 1892059409, &quot;start_datetime&quot;: &quot;2023-02-15T11:10:49Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:34:06.482346Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.238398052489366, -0.21853638, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-0.21853638, 53.21521939034109], [-0.29727173, 53.07336214876076], [-0.37646484, 52.92986476747993], [-0.4553833, 52.78633419317544], [-0.5336914, 52.64273107513841], [-0.61172485, 52.49909361271304], [-0.6890259, 52.3553514159923], [-0.75177, 52.238398052489366], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074], [-0.21853638, 53.21521939034109]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;4&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2A&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;039931&quot;, &quot;Start Relative Orbit Number&quot;: &quot;037&quot;, &quot;__folium_color&quot;: &quot;#2ca02c&quot;, &quot;created&quot;: &quot;2024-02-07T11:33:11.400309Z&quot;, &quot;datetime&quot;: &quot;2023-02-13T11:21:51Z&quot;, &quot;end_datetime&quot;: &quot;2023-02-13T11:21:51Z&quot;, &quot;eo:cloud_cover&quot;: &quot;43.1590052268317&quot;, &quot;esa_file_name&quot;: &quot;S2A_MSIL1C_20230213T112151_N0509_R037_T30UXD_20230213T132023&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.02.13.S2A_20230213_lat53lon071_T30UXD_ORB037_utm30n_osgb&quot;, &quot;size&quot;: 1339646778, &quot;start_datetime&quot;: &quot;2023-02-13T11:21:51Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:33:11.400309Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.23840804091191, -0.2164917, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-0.2164917, 53.21517944122803], [-0.2808838, 53.09978176113148], [-0.36038208, 52.95622266262845], [-0.43984985, 52.81260269934321], [-0.5192871, 52.66894356965986], [-0.5980835, 52.52531734666701], [-0.67575073, 52.38170954324063], [-0.7384033, 52.26435597865629], [-0.7522888, 52.23840804091191], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074], [-0.2164917, 53.21517944122803]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;5&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2B&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;030951&quot;, &quot;Start Relative Orbit Number&quot;: &quot;037&quot;, &quot;__folium_color&quot;: &quot;#c7c7c7&quot;, &quot;created&quot;: &quot;2024-02-07T11:32:32.578525Z&quot;, &quot;datetime&quot;: &quot;2023-02-08T11:21:29Z&quot;, &quot;end_datetime&quot;: &quot;2023-02-08T11:21:29Z&quot;, &quot;eo:cloud_cover&quot;: &quot;67.8265179209905&quot;, &quot;esa_file_name&quot;: &quot;S2B_MSIL1C_20230208T112129_N0509_R037_T30UXD_20230208T120439&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.02.08.S2B_20230208_lat53lon071_T30UXD_ORB037_utm30n_osgb&quot;, &quot;size&quot;: 1235043189, &quot;start_datetime&quot;: &quot;2023-02-08T11:21:29Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:32:32.578525Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.22256603361336, 0.141769904481162, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-1.5015259, 53.24020834947074], [0.141769904481162, 53.20820137275637], [0.071678487044592, 52.22256603361336], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;6&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2A&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;039745&quot;, &quot;Start Relative Orbit Number&quot;: &quot;137&quot;, &quot;__folium_color&quot;: &quot;#ff7f0e&quot;, &quot;created&quot;: &quot;2024-02-07T11:30:28.398201Z&quot;, &quot;datetime&quot;: &quot;2023-01-31T11:13:11Z&quot;, &quot;end_datetime&quot;: &quot;2023-01-31T11:13:11Z&quot;, &quot;eo:cloud_cover&quot;: &quot;10.8001433306459&quot;, &quot;esa_file_name&quot;: &quot;S2A_MSIL1C_20230131T111311_N0509_R137_T30UXD_20230131T131631&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.01.31.S2A_20230131_lat53lon071_T30UXD_ORB137_utm30n_osgb&quot;, &quot;size&quot;: 2007666944, &quot;start_datetime&quot;: &quot;2023-01-31T11:13:11Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:30:28.398201Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.23824823113123, -0.2088623, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-0.2088623, 53.21503053976478], [-0.26272583, 53.11818734711176], [-0.34204102, 52.97471822646446], [-0.42114258, 52.831157536476105], [-0.50024414, 52.68752303087626], [-0.57888794, 52.54390192243877], [-0.65689087, 52.40031283749618], [-0.73410034, 52.25664864107502], [-0.74398804, 52.23824823113123], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074], [-0.2088623, 53.21503053976478]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;7&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2B&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;030808&quot;, &quot;Start Relative Orbit Number&quot;: &quot;037&quot;, &quot;__folium_color&quot;: &quot;#f7b6d2&quot;, &quot;created&quot;: &quot;2024-02-07T11:29:54.260639Z&quot;, &quot;datetime&quot;: &quot;2023-01-29T11:22:29Z&quot;, &quot;end_datetime&quot;: &quot;2023-01-29T11:22:29Z&quot;, &quot;eo:cloud_cover&quot;: &quot;92.6610710353042&quot;, &quot;esa_file_name&quot;: &quot;S2B_MSIL1C_20230129T112229_N0509_R037_T30UXD_20230129T120514&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.01.29.S2B_20230129_lat53lon071_T30UXD_ORB037_utm30n_osgb&quot;, &quot;size&quot;: 1296391770, &quot;start_datetime&quot;: &quot;2023-01-29T11:22:29Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:29:54.260639Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.22256603361336, 0.141769904481162, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-1.5015259, 53.24020834947074], [0.141769904481162, 53.20820137275637], [0.071678487044592, 52.22256603361336], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;8&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2B&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;030765&quot;, &quot;Start Relative Orbit Number&quot;: &quot;137&quot;, &quot;__folium_color&quot;: &quot;#c49c94&quot;, &quot;created&quot;: &quot;2024-02-07T11:28:53.836836Z&quot;, &quot;datetime&quot;: &quot;2023-01-26T11:12:39Z&quot;, &quot;end_datetime&quot;: &quot;2023-01-26T11:12:39Z&quot;, &quot;eo:cloud_cover&quot;: &quot;18.1858520708292&quot;, &quot;esa_file_name&quot;: &quot;S2B_MSIL1C_20230126T111239_N0509_R137_T30UXD_20230126T115320&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.01.26.S2B_20230126_lat53lon071_T30UXD_ORB137_utm30n_osgb&quot;, &quot;size&quot;: 2010234013, &quot;start_datetime&quot;: &quot;2023-01-26T11:12:39Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:28:53.836836Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-1.5350342, 52.238275005287306, -0.21170044, 53.24020834947074], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-0.21170044, 53.21508618323158], [-0.25567627, 53.13619148116655], [-0.3352356, 52.9926520816641], [-0.4144287, 52.8491056114023], [-0.4930725, 52.705513587293886], [-0.57128906, 52.56191121821665], [-0.64886475, 52.41824091943656], [-0.7260132, 52.27449119356601], [-0.74539185, 52.238275005287306], [-1.5350342, 52.25345680664421], [-1.5015259, 53.24020834947074], [-0.21170044, 53.21508618323158]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;9&quot;, &quot;properties&quot;: {&quot;Datatake Type&quot;: &quot;INS-NOBS&quot;, &quot;EPSG&quot;: &quot;27700&quot;, &quot;Ground Tracking Direction&quot;: &quot;descending&quot;, &quot;Instrument Family Name&quot;: &quot;Multi-Spectral Instrument&quot;, &quot;Instrument Family Name Abbreviation&quot;: &quot;MSI&quot;, &quot;Instrument Mode&quot;: null, &quot;NSSDC Identifier&quot;: &quot;2015-000A&quot;, &quot;Platform Number&quot;: &quot;2A&quot;, &quot;Product Type&quot;: &quot;S2MSI1C&quot;, &quot;Start Orbit Number&quot;: &quot;039645&quot;, &quot;Start Relative Orbit Number&quot;: &quot;037&quot;, &quot;__folium_color&quot;: &quot;#1f77b4&quot;, &quot;created&quot;: &quot;2024-02-07T11:27:51.413302Z&quot;, &quot;datetime&quot;: &quot;2023-01-24T11:23:41Z&quot;, &quot;end_datetime&quot;: &quot;2023-01-24T11:23:41Z&quot;, &quot;eo:cloud_cover&quot;: &quot;0.0&quot;, &quot;esa_file_name&quot;: &quot;S2A_MSIL1C_20230124T112341_N0509_R037_T30UXD_20230124T145925&quot;, &quot;file_count&quot;: 7, &quot;instance_id&quot;: &quot;neodc.sentinel_ard.data.sentinel_2.2023.01.24.S2A_20230124_lat53lon071_T30UXD_ORB037_utm30n_osgb&quot;, &quot;size&quot;: 1257276075, &quot;start_datetime&quot;: &quot;2023-01-24T11:23:41Z&quot;, &quot;updated&quot;: &quot;2024-02-07T11:27:51.413302Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_f2ea71130e2a0fcad8d49fedb72e2723.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;esa_file_name&quot;, &quot;datetime&quot;, &quot;eo:cloud_cover&quot;];
    let aliases = [&quot;esa_file_name&quot;, &quot;datetime&quot;, &quot;eo:cloud_cover&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
            geo_json_f2ea71130e2a0fcad8d49fedb72e2723.addTo(map_21bbde2d72780ee684e1816f1071fb0e);
        
</script>
</html>" width="600" height="400" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
<div id="62d75baf-45ad-4a24-a7ed-329917e13041" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CONSTRUCT DASK DATASET</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: there are 9 STAC Items on input, and only one timeslice on output. </span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Due to groupby="solar_day" (all items that occured on the same day added to one image plane).</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Since we will plot it on a map we need to use `EPSG:3857` projection</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>crs <span class="op">=</span> <span class="st">"epsg:3857"</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>zoom <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">5</span>  <span class="co"># overview level 5</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co">#xx = stac_load(</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    items,</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    bands=("B04", "B03", "B02"),</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    crs=crs,</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co">#    resolution=10 * zoom)#,</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="co">#    chunks={},  # &lt;-- use Dask</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="co">#    groupby="solar_day",</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="co">#display(xx)</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co">#xx = stac_load(</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    items,</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="co">#    chunks={"x": 2048, "y": 2048},</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    patch_url=pc.sign,</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="co">#    resolution=resolution,</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="co">#    # force dtype and nodata</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    dtype="uint16",</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co">#    nodata=0,</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>xx <span class="op">=</span> stac_load(</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    items,</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>crs,</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    resolution<span class="op">=</span><span class="dv">10</span> <span class="op">*</span> zoom,</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">2048</span>, <span class="st">"y"</span>: <span class="dv">2048</span>},  <span class="co"># &lt;-- use Dask</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bands: </span><span class="sc">{</span><span class="st">','</span><span class="sc">.</span>join(<span class="bu">list</span>(xx.data_vars))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>display(xx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bands: cloud,thumbnail,topographic_shadow,cog,valid_pixels,saturated_pixels</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt; Size: 82MB
Dimensions:             (y: 586, x: 584, time: 10)
Coordinates:
  * y                   (y) float64 5kB 7.028e+06 7.027e+06 ... 6.84e+06
  * x                   (x) float64 5kB -1.707e+05 -1.704e+05 ... 1.584e+04
    spatial_ref         int32 4B 3857
  * time                (time) datetime64[ns] 80B 2023-01-24T11:23:41 ... 202...
Data variables:
    cloud               (time, y, x) float32 14MB dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;
    thumbnail           (time, y, x) float32 14MB dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;
    topographic_shadow  (time, y, x) float32 14MB dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;
    cog                 (time, y, x) float32 14MB dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;
    valid_pixels        (time, y, x) float32 14MB dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;
    saturated_pixels    (time, y, x) float32 14MB dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-b8464ec1-4176-4eb0-a606-76545f929023" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-b8464ec1-4176-4eb0-a606-76545f929023" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">y</span>: 586</li><li><span class="xr-has-index">x</span>: 584</li><li><span class="xr-has-index">time</span>: 10</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-5e8cc20b-e17f-40c7-bea9-205bbda8e102" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-5e8cc20b-e17f-40c7-bea9-205bbda8e102" class="xr-section-summary">Coordinates: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.028e+06 7.027e+06 ... 6.84e+06</div><input id="attrs-70ff3e7f-8594-4227-88f3-db57bc9adc83" class="xr-var-attrs-in" type="checkbox"><label for="attrs-70ff3e7f-8594-4227-88f3-db57bc9adc83" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-37c9b7e6-2236-4fb0-b8b4-378d89a9eaa4" class="xr-var-data-in" type="checkbox"><label for="data-37c9b7e6-2236-4fb0-b8b4-378d89a9eaa4" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>units :</span></dt><dd>metre</dd><dt><span>resolution :</span></dt><dd>-320.0</dd><dt><span>crs :</span></dt><dd>EPSG:3857</dd></dl></div><div class="xr-var-data"><pre>array([7027680., 7027360., 7027040., ..., 6841120., 6840800., 6840480.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-1.707e+05 -1.704e+05 ... 1.584e+04</div><input id="attrs-e3fd9bb5-37f6-4dad-a89b-29a8ee29d490" class="xr-var-attrs-in" type="checkbox"><label for="attrs-e3fd9bb5-37f6-4dad-a89b-29a8ee29d490" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-86393aa3-9546-4024-bd3b-15bae793d1cf" class="xr-var-data-in" type="checkbox"><label for="data-86393aa3-9546-4024-bd3b-15bae793d1cf" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>units :</span></dt><dd>metre</dd><dt><span>resolution :</span></dt><dd>320.0</dd><dt><span>crs :</span></dt><dd>EPSG:3857</dd></dl></div><div class="xr-var-data"><pre>array([-170720., -170400., -170080., ...,   15200.,   15520.,   15840.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>spatial_ref</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int32</div><div class="xr-var-preview xr-preview">3857</div><input id="attrs-38be0270-b3fd-4ba0-99c5-81aee3f8343e" class="xr-var-attrs-in" type="checkbox"><label for="attrs-38be0270-b3fd-4ba0-99c5-81aee3f8343e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-04305ea1-5d90-4593-8b1e-8a3ff3a26d33" class="xr-var-data-in" type="checkbox"><label for="data-04305ea1-5d90-4593-8b1e-8a3ff3a26d33" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>spatial_ref :</span></dt><dd>PROJCRS["WGS 84 / Pseudo-Mercator",BASEGEOGCRS["WGS 84",ENSEMBLE["World Geodetic System 1984 ensemble",MEMBER["World Geodetic System 1984 (Transit)"],MEMBER["World Geodetic System 1984 (G730)"],MEMBER["World Geodetic System 1984 (G873)"],MEMBER["World Geodetic System 1984 (G1150)"],MEMBER["World Geodetic System 1984 (G1674)"],MEMBER["World Geodetic System 1984 (G1762)"],MEMBER["World Geodetic System 1984 (G2139)"],ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]],ENSEMBLEACCURACY[2.0]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]],CONVERSION["Popular Visualisation Pseudo-Mercator",METHOD["Popular Visualisation Pseudo Mercator",ID["EPSG",1024]],PARAMETER["Latitude of natural origin",0,ANGLEUNIT["degree",0.0174532925199433],ID["EPSG",8801]],PARAMETER["Longitude of natural origin",0,ANGLEUNIT["degree",0.0174532925199433],ID["EPSG",8802]],PARAMETER["False easting",0,LENGTHUNIT["metre",1],ID["EPSG",8806]],PARAMETER["False northing",0,LENGTHUNIT["metre",1],ID["EPSG",8807]]],CS[Cartesian,2],AXIS["easting (X)",east,ORDER[1],LENGTHUNIT["metre",1]],AXIS["northing (Y)",north,ORDER[2],LENGTHUNIT["metre",1]],USAGE[SCOPE["Web mapping and visualisation."],AREA["World between 85.06°S and 85.06°N."],BBOX[-85.06,-180,85.06,180]],ID["EPSG",3857]]</dd><dt><span>crs_wkt :</span></dt><dd>PROJCRS["WGS 84 / Pseudo-Mercator",BASEGEOGCRS["WGS 84",ENSEMBLE["World Geodetic System 1984 ensemble",MEMBER["World Geodetic System 1984 (Transit)"],MEMBER["World Geodetic System 1984 (G730)"],MEMBER["World Geodetic System 1984 (G873)"],MEMBER["World Geodetic System 1984 (G1150)"],MEMBER["World Geodetic System 1984 (G1674)"],MEMBER["World Geodetic System 1984 (G1762)"],MEMBER["World Geodetic System 1984 (G2139)"],ELLIPSOID["WGS 84",6378137,298.257223563,LENGTHUNIT["metre",1]],ENSEMBLEACCURACY[2.0]],PRIMEM["Greenwich",0,ANGLEUNIT["degree",0.0174532925199433]],ID["EPSG",4326]],CONVERSION["Popular Visualisation Pseudo-Mercator",METHOD["Popular Visualisation Pseudo Mercator",ID["EPSG",1024]],PARAMETER["Latitude of natural origin",0,ANGLEUNIT["degree",0.0174532925199433],ID["EPSG",8801]],PARAMETER["Longitude of natural origin",0,ANGLEUNIT["degree",0.0174532925199433],ID["EPSG",8802]],PARAMETER["False easting",0,LENGTHUNIT["metre",1],ID["EPSG",8806]],PARAMETER["False northing",0,LENGTHUNIT["metre",1],ID["EPSG",8807]]],CS[Cartesian,2],AXIS["easting (X)",east,ORDER[1],LENGTHUNIT["metre",1]],AXIS["northing (Y)",north,ORDER[2],LENGTHUNIT["metre",1]],USAGE[SCOPE["Web mapping and visualisation."],AREA["World between 85.06°S and 85.06°N."],BBOX[-85.06,-180,85.06,180]],ID["EPSG",3857]]</dd><dt><span>GeoTransform :</span></dt><dd>-170880 320 0 7027840 0 -320</dd></dl></div><div class="xr-var-data"><pre>array(3857, dtype=int32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">time</span></div><div class="xr-var-dims">(time)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2023-01-24T11:23:41 ... 2023-02-...</div><input id="attrs-4e31d7f9-4f57-412e-bcfd-a44e77a0e7ce" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-4e31d7f9-4f57-412e-bcfd-a44e77a0e7ce" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-ded43e3a-0b14-40ea-b715-b8e6e0a72f50" class="xr-var-data-in" type="checkbox"><label for="data-ded43e3a-0b14-40ea-b715-b8e6e0a72f50" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2023-01-24T11:23:41.000000000', '2023-01-26T11:12:39.000000000',
       '2023-01-29T11:22:29.000000000', '2023-01-31T11:13:11.000000000',
       '2023-02-08T11:21:29.000000000', '2023-02-13T11:21:51.000000000',
       '2023-02-15T11:10:49.000000000', '2023-02-20T11:11:01.000000000',
       '2023-02-23T11:21:11.000000000', '2023-02-25T11:09:39.000000000'],
      dtype='datetime64[ns]')</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-91f136b5-0bb9-48be-8fa7-7cb2c9308e51" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-91f136b5-0bb9-48be-8fa7-7cb2c9308e51" class="xr-section-summary">Data variables: <span>(6)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>cloud</span></div><div class="xr-var-dims">(time, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</div><input id="attrs-4cd91369-be09-4e73-bd47-5be113ae3803" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-4cd91369-be09-4e73-bd47-5be113ae3803" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-650eec11-e9de-4bb0-a8fd-7e1eece60369" class="xr-var-data-in" type="checkbox"><label for="data-650eec11-e9de-4bb0-a8fd-7e1eece60369" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>13.05 MiB</td>
<td>1.31 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10, 586, 584)</td>
<td>(1, 586, 584)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">10 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float32 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="196" height="186" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="10" y1="120" x2="26" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2"></line> <line x1="11" y1="1" x2="11" y2="121"></line> <line x1="13" y1="3" x2="13" y2="123"></line> <line x1="14" y1="4" x2="14" y2="124"></line> <line x1="16" y1="6" x2="16" y2="126"></line> <line x1="18" y1="8" x2="18" y2="128"></line> <line x1="19" y1="9" x2="19" y2="129"></line> <line x1="21" y1="11" x2="21" y2="131"></line> <line x1="23" y1="13" x2="23" y2="133"></line> <line x1="24" y1="14" x2="24" y2="134"></line> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 26.559590992113687,16.559590992113687 26.559590992113687,136.5595909921137 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="10" y1="0" x2="129" y2="0" style="stroke-width:2"></line> <line x1="11" y1="1" x2="131" y2="1"></line> <line x1="13" y1="3" x2="132" y2="3"></line> <line x1="14" y1="4" x2="134" y2="4"></line> <line x1="16" y1="6" x2="136" y2="6"></line> <line x1="18" y1="8" x2="137" y2="8"></line> <line x1="19" y1="9" x2="139" y2="9"></line> <line x1="21" y1="11" x2="141" y2="11"></line> <line x1="23" y1="13" x2="142" y2="13"></line> <line x1="24" y1="14" x2="144" y2="14"></line> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="129" y1="0" x2="146" y2="16" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 129.59044368600684,0.0 146.15003467812053,16.559590992113687 26.559590992113687,16.559590992113687" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <line x1="26" y1="136" x2="146" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <line x1="146" y1="16" x2="146" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="26.559590992113687,16.559590992113687 146.1500346781205,16.559590992113687 146.1500346781205,136.5595909921137 26.559590992113687,136.5595909921137" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Text --> <text x="86.354813" y="156.559591" font-size="1.0rem" font-weight="100" text-anchor="middle">584</text> <text x="166.150035" y="76.559591" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,166.150035,76.559591)">586</text> <text x="8.279795" y="148.279795" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.279795,148.279795)">10</text>
</svg></td>
</tr>
</tbody>
</table>
</div></li><li class="xr-var-item"><div class="xr-var-name"><span>thumbnail</span></div><div class="xr-var-dims">(time, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</div><input id="attrs-cfce2d6c-ed2f-4b4d-9c86-70020d8e6f5f" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-cfce2d6c-ed2f-4b4d-9c86-70020d8e6f5f" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-6872b5b3-dfd6-421b-ae4e-d19e521f8e3d" class="xr-var-data-in" type="checkbox"><label for="data-6872b5b3-dfd6-421b-ae4e-d19e521f8e3d" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>13.05 MiB</td>
<td>1.31 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10, 586, 584)</td>
<td>(1, 586, 584)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">10 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float32 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="196" height="186" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="10" y1="120" x2="26" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2"></line> <line x1="11" y1="1" x2="11" y2="121"></line> <line x1="13" y1="3" x2="13" y2="123"></line> <line x1="14" y1="4" x2="14" y2="124"></line> <line x1="16" y1="6" x2="16" y2="126"></line> <line x1="18" y1="8" x2="18" y2="128"></line> <line x1="19" y1="9" x2="19" y2="129"></line> <line x1="21" y1="11" x2="21" y2="131"></line> <line x1="23" y1="13" x2="23" y2="133"></line> <line x1="24" y1="14" x2="24" y2="134"></line> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 26.559590992113687,16.559590992113687 26.559590992113687,136.5595909921137 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="10" y1="0" x2="129" y2="0" style="stroke-width:2"></line> <line x1="11" y1="1" x2="131" y2="1"></line> <line x1="13" y1="3" x2="132" y2="3"></line> <line x1="14" y1="4" x2="134" y2="4"></line> <line x1="16" y1="6" x2="136" y2="6"></line> <line x1="18" y1="8" x2="137" y2="8"></line> <line x1="19" y1="9" x2="139" y2="9"></line> <line x1="21" y1="11" x2="141" y2="11"></line> <line x1="23" y1="13" x2="142" y2="13"></line> <line x1="24" y1="14" x2="144" y2="14"></line> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="129" y1="0" x2="146" y2="16" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 129.59044368600684,0.0 146.15003467812053,16.559590992113687 26.559590992113687,16.559590992113687" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <line x1="26" y1="136" x2="146" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <line x1="146" y1="16" x2="146" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="26.559590992113687,16.559590992113687 146.1500346781205,16.559590992113687 146.1500346781205,136.5595909921137 26.559590992113687,136.5595909921137" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Text --> <text x="86.354813" y="156.559591" font-size="1.0rem" font-weight="100" text-anchor="middle">584</text> <text x="166.150035" y="76.559591" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,166.150035,76.559591)">586</text> <text x="8.279795" y="148.279795" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.279795,148.279795)">10</text>
</svg></td>
</tr>
</tbody>
</table>
</div></li><li class="xr-var-item"><div class="xr-var-name"><span>topographic_shadow</span></div><div class="xr-var-dims">(time, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</div><input id="attrs-9c5c3695-ec77-47bf-9364-c1924f901855" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-9c5c3695-ec77-47bf-9364-c1924f901855" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-905a6884-caee-4a3b-9666-03df54c95d42" class="xr-var-data-in" type="checkbox"><label for="data-905a6884-caee-4a3b-9666-03df54c95d42" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>13.05 MiB</td>
<td>1.31 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10, 586, 584)</td>
<td>(1, 586, 584)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">10 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float32 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="196" height="186" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="10" y1="120" x2="26" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2"></line> <line x1="11" y1="1" x2="11" y2="121"></line> <line x1="13" y1="3" x2="13" y2="123"></line> <line x1="14" y1="4" x2="14" y2="124"></line> <line x1="16" y1="6" x2="16" y2="126"></line> <line x1="18" y1="8" x2="18" y2="128"></line> <line x1="19" y1="9" x2="19" y2="129"></line> <line x1="21" y1="11" x2="21" y2="131"></line> <line x1="23" y1="13" x2="23" y2="133"></line> <line x1="24" y1="14" x2="24" y2="134"></line> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 26.559590992113687,16.559590992113687 26.559590992113687,136.5595909921137 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="10" y1="0" x2="129" y2="0" style="stroke-width:2"></line> <line x1="11" y1="1" x2="131" y2="1"></line> <line x1="13" y1="3" x2="132" y2="3"></line> <line x1="14" y1="4" x2="134" y2="4"></line> <line x1="16" y1="6" x2="136" y2="6"></line> <line x1="18" y1="8" x2="137" y2="8"></line> <line x1="19" y1="9" x2="139" y2="9"></line> <line x1="21" y1="11" x2="141" y2="11"></line> <line x1="23" y1="13" x2="142" y2="13"></line> <line x1="24" y1="14" x2="144" y2="14"></line> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="129" y1="0" x2="146" y2="16" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 129.59044368600684,0.0 146.15003467812053,16.559590992113687 26.559590992113687,16.559590992113687" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <line x1="26" y1="136" x2="146" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <line x1="146" y1="16" x2="146" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="26.559590992113687,16.559590992113687 146.1500346781205,16.559590992113687 146.1500346781205,136.5595909921137 26.559590992113687,136.5595909921137" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Text --> <text x="86.354813" y="156.559591" font-size="1.0rem" font-weight="100" text-anchor="middle">584</text> <text x="166.150035" y="76.559591" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,166.150035,76.559591)">586</text> <text x="8.279795" y="148.279795" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.279795,148.279795)">10</text>
</svg></td>
</tr>
</tbody>
</table>
</div></li><li class="xr-var-item"><div class="xr-var-name"><span>cog</span></div><div class="xr-var-dims">(time, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</div><input id="attrs-2a5c81cd-03f2-474a-9fba-d91ce7032534" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-2a5c81cd-03f2-474a-9fba-d91ce7032534" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c227e7c4-75e7-4afb-9e40-0e8236a21677" class="xr-var-data-in" type="checkbox"><label for="data-c227e7c4-75e7-4afb-9e40-0e8236a21677" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>13.05 MiB</td>
<td>1.31 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10, 586, 584)</td>
<td>(1, 586, 584)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">10 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float32 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="196" height="186" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="10" y1="120" x2="26" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2"></line> <line x1="11" y1="1" x2="11" y2="121"></line> <line x1="13" y1="3" x2="13" y2="123"></line> <line x1="14" y1="4" x2="14" y2="124"></line> <line x1="16" y1="6" x2="16" y2="126"></line> <line x1="18" y1="8" x2="18" y2="128"></line> <line x1="19" y1="9" x2="19" y2="129"></line> <line x1="21" y1="11" x2="21" y2="131"></line> <line x1="23" y1="13" x2="23" y2="133"></line> <line x1="24" y1="14" x2="24" y2="134"></line> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 26.559590992113687,16.559590992113687 26.559590992113687,136.5595909921137 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="10" y1="0" x2="129" y2="0" style="stroke-width:2"></line> <line x1="11" y1="1" x2="131" y2="1"></line> <line x1="13" y1="3" x2="132" y2="3"></line> <line x1="14" y1="4" x2="134" y2="4"></line> <line x1="16" y1="6" x2="136" y2="6"></line> <line x1="18" y1="8" x2="137" y2="8"></line> <line x1="19" y1="9" x2="139" y2="9"></line> <line x1="21" y1="11" x2="141" y2="11"></line> <line x1="23" y1="13" x2="142" y2="13"></line> <line x1="24" y1="14" x2="144" y2="14"></line> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="129" y1="0" x2="146" y2="16" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 129.59044368600684,0.0 146.15003467812053,16.559590992113687 26.559590992113687,16.559590992113687" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <line x1="26" y1="136" x2="146" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <line x1="146" y1="16" x2="146" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="26.559590992113687,16.559590992113687 146.1500346781205,16.559590992113687 146.1500346781205,136.5595909921137 26.559590992113687,136.5595909921137" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Text --> <text x="86.354813" y="156.559591" font-size="1.0rem" font-weight="100" text-anchor="middle">584</text> <text x="166.150035" y="76.559591" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,166.150035,76.559591)">586</text> <text x="8.279795" y="148.279795" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.279795,148.279795)">10</text>
</svg></td>
</tr>
</tbody>
</table>
</div></li><li class="xr-var-item"><div class="xr-var-name"><span>valid_pixels</span></div><div class="xr-var-dims">(time, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</div><input id="attrs-d95c5329-0713-4c0a-ba12-8e38f8665194" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-d95c5329-0713-4c0a-ba12-8e38f8665194" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-6ed4e2a0-4e5e-49ad-bc68-3c685fe344da" class="xr-var-data-in" type="checkbox"><label for="data-6ed4e2a0-4e5e-49ad-bc68-3c685fe344da" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>13.05 MiB</td>
<td>1.31 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10, 586, 584)</td>
<td>(1, 586, 584)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">10 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float32 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="196" height="186" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="10" y1="120" x2="26" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2"></line> <line x1="11" y1="1" x2="11" y2="121"></line> <line x1="13" y1="3" x2="13" y2="123"></line> <line x1="14" y1="4" x2="14" y2="124"></line> <line x1="16" y1="6" x2="16" y2="126"></line> <line x1="18" y1="8" x2="18" y2="128"></line> <line x1="19" y1="9" x2="19" y2="129"></line> <line x1="21" y1="11" x2="21" y2="131"></line> <line x1="23" y1="13" x2="23" y2="133"></line> <line x1="24" y1="14" x2="24" y2="134"></line> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 26.559590992113687,16.559590992113687 26.559590992113687,136.5595909921137 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="10" y1="0" x2="129" y2="0" style="stroke-width:2"></line> <line x1="11" y1="1" x2="131" y2="1"></line> <line x1="13" y1="3" x2="132" y2="3"></line> <line x1="14" y1="4" x2="134" y2="4"></line> <line x1="16" y1="6" x2="136" y2="6"></line> <line x1="18" y1="8" x2="137" y2="8"></line> <line x1="19" y1="9" x2="139" y2="9"></line> <line x1="21" y1="11" x2="141" y2="11"></line> <line x1="23" y1="13" x2="142" y2="13"></line> <line x1="24" y1="14" x2="144" y2="14"></line> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="129" y1="0" x2="146" y2="16" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 129.59044368600684,0.0 146.15003467812053,16.559590992113687 26.559590992113687,16.559590992113687" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <line x1="26" y1="136" x2="146" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <line x1="146" y1="16" x2="146" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="26.559590992113687,16.559590992113687 146.1500346781205,16.559590992113687 146.1500346781205,136.5595909921137 26.559590992113687,136.5595909921137" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Text --> <text x="86.354813" y="156.559591" font-size="1.0rem" font-weight="100" text-anchor="middle">584</text> <text x="166.150035" y="76.559591" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,166.150035,76.559591)">586</text> <text x="8.279795" y="148.279795" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.279795,148.279795)">10</text>
</svg></td>
</tr>
</tbody>
</table>
</div></li><li class="xr-var-item"><div class="xr-var-name"><span>saturated_pixels</span></div><div class="xr-var-dims">(time, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">dask.array&lt;chunksize=(1, 586, 584), meta=np.ndarray&gt;</div><input id="attrs-13b1ab73-f0da-4005-b74e-657f87bd3395" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-13b1ab73-f0da-4005-b74e-657f87bd3395" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-07222047-dd8d-48e5-bc0d-fe39347dd5ac" class="xr-var-data-in" type="checkbox"><label for="data-07222047-dd8d-48e5-bc0d-fe39347dd5ac" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>13.05 MiB</td>
<td>1.31 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10, 586, 584)</td>
<td>(1, 586, 584)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">10 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float32 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="196" height="186" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="10" y1="120" x2="26" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2"></line> <line x1="11" y1="1" x2="11" y2="121"></line> <line x1="13" y1="3" x2="13" y2="123"></line> <line x1="14" y1="4" x2="14" y2="124"></line> <line x1="16" y1="6" x2="16" y2="126"></line> <line x1="18" y1="8" x2="18" y2="128"></line> <line x1="19" y1="9" x2="19" y2="129"></line> <line x1="21" y1="11" x2="21" y2="131"></line> <line x1="23" y1="13" x2="23" y2="133"></line> <line x1="24" y1="14" x2="24" y2="134"></line> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 26.559590992113687,16.559590992113687 26.559590992113687,136.5595909921137 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="10" y1="0" x2="129" y2="0" style="stroke-width:2"></line> <line x1="11" y1="1" x2="131" y2="1"></line> <line x1="13" y1="3" x2="132" y2="3"></line> <line x1="14" y1="4" x2="134" y2="4"></line> <line x1="16" y1="6" x2="136" y2="6"></line> <line x1="18" y1="8" x2="137" y2="8"></line> <line x1="19" y1="9" x2="139" y2="9"></line> <line x1="21" y1="11" x2="141" y2="11"></line> <line x1="23" y1="13" x2="142" y2="13"></line> <line x1="24" y1="14" x2="144" y2="14"></line> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="10" y1="0" x2="26" y2="16" style="stroke-width:2"></line> <line x1="129" y1="0" x2="146" y2="16" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="10.0,0.0 129.59044368600684,0.0 146.15003467812053,16.559590992113687 26.559590992113687,16.559590992113687" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Horizontal lines --> <line x1="26" y1="16" x2="146" y2="16" style="stroke-width:2"></line> <line x1="26" y1="136" x2="146" y2="136" style="stroke-width:2"></line> <!-- Vertical lines --> <line x1="26" y1="16" x2="26" y2="136" style="stroke-width:2"></line> <line x1="146" y1="16" x2="146" y2="136" style="stroke-width:2"></line> <!-- Colored Rectangle --> <polygon points="26.559590992113687,16.559590992113687 146.1500346781205,16.559590992113687 146.1500346781205,136.5595909921137 26.559590992113687,136.5595909921137" style="fill:#ECB172A0;stroke-width:0"></polygon> <!-- Text --> <text x="86.354813" y="156.559591" font-size="1.0rem" font-weight="100" text-anchor="middle">584</text> <text x="166.150035" y="76.559591" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,166.150035,76.559591)">586</text> <text x="8.279795" y="148.279795" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.279795,148.279795)">10</text>
</svg></td>
</tr>
</tbody>
</table>
</div></li></ul></div></li><li class="xr-section-item"><input id="section-ba0c210d-a325-4f08-a08b-106c77553dc3" class="xr-section-summary-in" type="checkbox"><label for="section-ba0c210d-a325-4f08-a08b-106c77553dc3" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-1d64ca3b-9bba-4bd9-98ba-123fd08eb496" class="xr-index-data-in" type="checkbox"><label for="index-1d64ca3b-9bba-4bd9-98ba-123fd08eb496" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([7027680.0, 7027360.0, 7027040.0, 7026720.0, 7026400.0, 7026080.0,
       7025760.0, 7025440.0, 7025120.0, 7024800.0,
       ...
       6843360.0, 6843040.0, 6842720.0, 6842400.0, 6842080.0, 6841760.0,
       6841440.0, 6841120.0, 6840800.0, 6840480.0],
      dtype='float64', name='y', length=586))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-538b5ee7-210c-4268-a44e-9613f570ff36" class="xr-index-data-in" type="checkbox"><label for="index-538b5ee7-210c-4268-a44e-9613f570ff36" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([-170720.0, -170400.0, -170080.0, -169760.0, -169440.0, -169120.0,
       -168800.0, -168480.0, -168160.0, -167840.0,
       ...
         12960.0,   13280.0,   13600.0,   13920.0,   14240.0,   14560.0,
         14880.0,   15200.0,   15520.0,   15840.0],
      dtype='float64', name='x', length=584))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>time</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-5110a635-384a-43a9-a1b2-76bf56dcc7e5" class="xr-index-data-in" type="checkbox"><label for="index-5110a635-384a-43a9-a1b2-76bf56dcc7e5" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(DatetimeIndex(['2023-01-24 11:23:41', '2023-01-26 11:12:39',
               '2023-01-29 11:22:29', '2023-01-31 11:13:11',
               '2023-02-08 11:21:29', '2023-02-13 11:21:51',
               '2023-02-15 11:10:49', '2023-02-20 11:11:01',
               '2023-02-23 11:21:11', '2023-02-25 11:09:39'],
              dtype='datetime64[ns]', name='time', freq=None))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-cfbc0603-0c16-448e-8f43-fd171cac94f5" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-cfbc0603-0c16-448e-8f43-fd171cac94f5" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"></dl></div></li></ul></div></div>
</div>
</div>
<div id="bb663a98-2c2a-4480-b8bb-c180b786064a" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DATA FOOTPRINT</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#xx.odc.geobox</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TEST</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>xx.data_vars[cog]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="39c4270e-0d08-4ac5-9336-7ae4439e4fcb" class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>xx <span class="op">=</span> xx.compute() <span class="co"># LOAD INTO LOCAL MEMORY</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/EO-DataHub\.github\.io\/eodh-training\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>